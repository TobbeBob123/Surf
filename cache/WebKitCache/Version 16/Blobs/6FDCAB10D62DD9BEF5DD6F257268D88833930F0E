"use strict";(()=>{var M=Object.defineProperty;var g=(O,_)=>M(O,"name",{value:_,configurable:!0});(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[9039,4656],{14656:(O,_,l)=>{l.r(_),l.d(_,{CommandPalettePageElement:()=>d});var f=l(90420),v=l(55623),I=l(65881),L=l(86004),x=l(26850),D=l(3447),m=l(30474),u=l(43832),i=Object.defineProperty,c=Object.getOwnPropertyDescriptor,h=g((e,t,s,r)=>{for(var n=r>1?void 0:r?c(t,s):t,a=e.length-1,o;a>=0;a--)(o=e[a])&&(n=(r?o(t,s,n):o(n))||n);return r&&n&&i(t,s,n),n},"__decorateClass"),y=g((e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)},"__accessCheck"),p=g((e,t,s)=>(y(e,t,"read from private field"),s?s.call(e):t.get(e)),"__privateGet"),b=g((e,t,s)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,s)},"__privateAdd"),P=g((e,t,s,r)=>(y(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s),"__privateSet"),E,S;let d=g(class extends HTMLElement{constructor(e={}){super();this.isRoot=!1,this.pageTitle="",this.scopeId="",this.scopeType="",this.hasVisibleTip=!1,this.currentHeight=0,this.octicons={},b(this,E,void 0),this.requestsInProgress=[],b(this,S,void 0),this.tryDefaultSelection=!0,this.items={};var t;this.hidden=(t=e.hidden)!=null?t:!0,this.page=e.page,P(this,E,new x.A("","",{scope:this.scope,subjectId:this.defaultScopeId,subjectType:this.defaultScopeType}))}get providers(){var e;return((e=this.page)==null?void 0:e.providers)||[]}get prefetchedProviders(){return this.providers.filter(e=>e.prefetch)}get query(){return p(this,E)}set query(e){this.items[e.path]||(this.items[e.path]=this.currentItems.filter(t=>t.calculateScore(e.text)>0)),P(this,E,e)}get scope(){return{text:this.pageTitle,type:this.scopeType,id:this.scopeId,tokens:[]}}get defaultScopeType(){const e=(0,m.I)();return e==null?void 0:e.defaultScopeType}get defaultScopeId(){const e=(0,m.I)();return e==null?void 0:e.defaultScopeId}get selectedItem(){return this.findSelectedElement()}set selectedItem(e){const t=this.findSelectedElement();t&&(t.selected=!1),e&&(e.selected=!0,this.selectedItemChanged(e.item))}get page(){return p(this,S)}set page(e){!e||(P(this,S,e),this.pageTitle=e.title,this.scopeId=e.scopeId,this.scopeType=e.scopeType)}get groups(){return Array.from(this.querySelectorAll("command-palette-item-group"))}get visibleGroups(){return this.groups.filter(e=>!e.hidden)}get currentItems(){const e=this.items[this.query.path];return e?this.query.isBlank()?e.sort((t,s)=>s.priority-t.priority):e.sort((t,s)=>{const r=t.calculateScore(this.query.text);return s.calculateScore(this.query.text)-r||s.priority-t.priority}):[]}get firstItem(){const e=this.visibleGroups;if(e.length>0)return e[0].querySelector("command-palette-item")}get shouldSetDefaultSelection(){return this.tryDefaultSelection&&this.query.isPresent()}get isSelectedItemInvalid(){return!this.currentItems.some(e=>{var t;return e.id===((t=this.selectedItem)==null?void 0:t.itemId)})}updateSelectedItem(){this.isSelectedItemInvalid&&this.clearSelection(),this.setDefaultSelection()&&(this.selectedItem=this.firstItem)}setDefaultSelection(){const e=this.query.hasScope()||this.query.isPresent();return this.tryDefaultSelection&&e}clearSelection(){this.selectedItem=void 0}findSelectedElement(){return this.querySelector("command-palette-item[data-selected]")}findGroup(e){return this.groups.find(t=>t.groupId===e)}navigate(e){var t,s;this.tryDefaultSelection=!1;const r=e>0,n={behavior:"smooth",block:"nearest"};if(this.selectedItem){let a;if(r?a=(t=this.selectedItem)==null?void 0:t.nextElementSibling:a=(s=this.selectedItem)==null?void 0:s.previousElementSibling,a)this.selectedItem=a,this.selectedItem.scrollIntoView(n);else if(this.selectedItem){const o=this.visibleGroups[this.calculateIndex(e)];o.scrollIntoView(n),r?this.selectedItem=o.firstItem:this.selectedItem=o.lastItem}}else this.selectedItem=this.firstItem}calculateIndex(e){let t=this.visibleGroups.findIndex(n=>{var a;return n.groupId===((a=this.selectedItem)==null?void 0:a.item.group)});this.findGroup(I.O.topGroupId).firstItem===this.selectedItem&&(t=0);const s=t+e,r=this.visibleGroups.length;return(s%r+r)%r}async prefetch(){await this.fetchWithSpinner(this.prefetchedProviders.map(async e=>{!e.prefetch||await e.prefetch(this.query)}))}async fetchWithDebounce(e,t,s){return e instanceof u.j?e.element.fetchWithDebounce(t,s):e.fetch(t,s)}async fetch(e=this.providers,t={}){if(this.hidden)return;const r={...{isEmpty:!1},...t},n=this.query;await this.prefetch(),await this.fetchWithSpinner(e.map(async a=>{if(!a||!a.enabledFor(n))return;const o=await this.fetchWithDebounce(a,n,r.isEmpty);o&&(o.error&&this.fetchError(),o.octicons&&o.octicons.length>0&&this.cacheIcons(o.octicons,!0),o.results.length>0&&this.addItems(n,o.results),this.renderCurrentItems())})),this.itemsUpdated()}async fetchWithSpinner(e){this.requestsInProgress.push(e),this.loadingStateChanged(!0),await Promise.all(e),this.requestsInProgress.splice(this.requestsInProgress.indexOf(e),1),this.loadingStateChanged(this.requestsInProgress.length>0)}addItems(e,t){e.path in this.items||(this.items[e.path]=[]),this.items[e.path].push(...t)}cacheIcons(e,t=!1){for(const s of e)this.octicons[s.id]=s.svg;t&&this.dispatchEvent(new CustomEvent("command-palette-page-octicons-cached",{bubbles:!0,detail:{octicons:e}}))}buildGroups(e){const s=[I.O.topGroupId,I.O.defaultGroupId,...new Set(e.map(n=>n.group))].map(n=>`command-palette-item-group[data-group-id="${n}"]`).join(","),r=document.querySelectorAll(s);for(const n of r)this.querySelector(`command-palette-item-group[data-group-id="${n.groupId}"]`)||this.append(n.cloneNode(!0))}setGroupBorders(){if(this.visibleGroups.length>0){this.visibleGroups[0].classList.remove("border-top");for(const e of this.visibleGroups)this.visibleGroups.indexOf(e)===0?(e.classList.remove("border-top"),e.header&&(e.classList.remove("py-2"),e.classList.add("mb-2"),this.hasVisibleTip?e.classList.remove("mt-3"):e.classList.add("mt-3"))):(e.classList.add("border-top"),e.header&&(e.classList.remove("mb-2","mt-3"),e.classList.add("py-2")))}}createItemElementAndRender(e,t,s){const r=new v.F;return r.setItemAttributes(e),r.render(t,s),r}renderCurrentItems(){this.reset();const e=this.currentItems,t=[];if(e&&e.length>0){this.buildGroups(e);for(const s of e){if(t.indexOf(s.id)>=0)continue;const r=s.calculateScore(this.query.text)+s.priority;let n=s.group||I.O.defaultGroupId;e.indexOf(s)===0&&r>d.TopResultThreshold&&(n="top");const a=this.createItemElementAndRender(s,!1,this.query.text),o=this.querySelector(`command-palette-item-group[data-group-id="${n}"]`);if(!o.atLimitForScopeType(this.scopeType)){if(o.push(a),t.push(s.id),s.icon)if(s.icon.type==="octicon"){const T=this.octicons[s.icon.id],C=this.octicons["dash-color-fg-muted"];a.renderOcticon(T||C)}else s.icon.type==="avatar"&&a.renderAvatar(s.icon.url,s.icon.alt);else a.iconElement.hidden=!0;a.addEventListener("mousemove",T=>{var C;(T.movementX!==0||T.movementY!==0)&&((C=this.selectedItem)==null?void 0:C.itemId)!==a.itemId&&(this.tryDefaultSelection=!1,this.selectedItem=a)})}}this.shouldSetDefaultSelection&&(this.selectedItem=this.firstItem),this.recomputeStyles(),this.updateSelectedItem()}}recomputeStyles(){this.setGroupBorders(),this.setMaxHeight()}get maximumHeight(){const s=window.innerHeight*.5;return Math.min(s,475)}get innerContentHeight(){let e=0;for(const t of this.children){const s=t,r=getComputedStyle(s),n=parseInt(r.marginTop.replace("px",""),10),a=parseInt(r.marginBottom.replace("px",""),10),o=s.offsetHeight+n+a;s.offsetHeight>0&&(e+=o)}return e}setMaxHeight(){const t=this.maximumHeight*.9,s=Math.round(Math.min(this.maximumHeight,this.innerContentHeight));Math.abs(this.currentHeight-s)>t?this.classList.add("no-transition"):this.classList.remove("no-transition"),this.setAttribute("style",`max-height:${s}px; min-height:${s}px;`),this.currentHeight=s}selectedItemChanged(e){const t=new CustomEvent("selectedItemChanged",{bubbles:!0,cancelable:!0,detail:{item:e,isDefaultSelection:this.tryDefaultSelection}});return this.dispatchEvent(t)}loadingStateChanged(e){const t=new CustomEvent("loadingStateChanged",{bubbles:!0,cancelable:!0,detail:{loading:e}});return this.dispatchEvent(t)}fetchError(){const e=new CustomEvent("pageFetchError",{bubbles:!0,cancelable:!0});return this.dispatchEvent(e)}itemsUpdated(){const e=this.currentItems,t=e.filter(r=>r.group===I.O.footerGroupId||I.O.helpGroupIds.includes(r.group));if(e.length-t.length===0&&this.requestsInProgress.length>0)return;const s=new CustomEvent("itemsUpdated",{bubbles:!0,detail:{items:e,queryPath:this.query.immutableCopy().path}});return this.dispatchEvent(s)}reactivate(e){this.query=e,this.hidden=!1,this.tryDefaultSelection=!0,this.recomputeStyles(),this.fetch()}reset(){this.tryDefaultSelection=!0,this.innerHTML=""}connectedCallback(){this.classList.add("rounded-bottom-2","page-stack-transition-height"),this.getAttribute("data-targets")||this.setAttribute("data-targets","command-palette-page-stack.pages"),this.setAttribute("style","max-height:400px;"),this.page||(this.page=new L.j({title:this.pageTitle,scopeId:this.scopeId,scopeType:this.scopeType}))}clearItems(){this.items={},this.reset()}},"CommandPalettePageElement");E=new WeakMap,S=new WeakMap,d.TopResultThreshold=6.5,h([f.Lj],d.prototype,"isRoot",2),h([f.Lj],d.prototype,"pageTitle",2),h([f.Lj],d.prototype,"scopeId",2),h([f.Lj],d.prototype,"scopeType",2),h([f.Lj],d.prototype,"hasVisibleTip",2),h([(0,D.D)(10)],d.prototype,"renderCurrentItems",1),d=h([f.Ih],d)},39039:(O,_,l)=>{l.r(_),l.d(_,{CommandPalettePageStackElement:()=>u});var f=l(34348),v=l(90420),I=l(14656),L=l(26850),x=Object.defineProperty,D=Object.getOwnPropertyDescriptor,m=g((i,c,h,y)=>{for(var p=y>1?void 0:y?D(c,h):c,b=i.length-1,P;b>=0;b--)(P=i[b])&&(p=(y?P(c,h,p):P(p))||p);return y&&p&&x(c,h,p),p},"__decorateClass");let u=g(class extends HTMLElement{constructor(){super(...arguments);this.currentMode="",this.currentQueryText="",this.hasVisibleTip=!1,this.eventListenersBound=!1,this.octiconCache={}}get currentPage(){return this.pages[this.pages.length-1]}get nonRootPages(){return this.pages.filter(i=>!i.isRoot)}get query(){return new L.A(this.currentQueryText,this.currentMode,{scope:this.scope,subjectId:this.currentPage.defaultScopeId,subjectType:this.currentPage.defaultScopeType})}get scope(){return this.currentPage.isRoot?f.v.emptyScope:{text:this.currentPage.pageTitle,type:this.currentPage.scopeType,id:this.currentPage.scopeId,tokens:this.nonRootPages.map(i=>({text:i.pageTitle,type:i.scopeType,id:i.scopeId,value:i.pageTitle}))}}push(i,c=!1){if(this.hasPage(i))return;const h=new I.CommandPalettePageElement({page:i,hidden:c});h.hasVisibleTip=this.hasVisibleTip,this.hideCurrentPages(),this.append(h),h.octicons=this.octiconCache,h.fetch(),this.pageStackUpdated()}pop(){this.currentPage.isRoot||(this.removeChild(this.currentPage),this.activateCurrentPage())}clear(i=!0){for(const c of this.nonRootPages)this.removeChild(c);i&&this.activateCurrentPage()}reset(i){this.clear(!1),this.currentPage.clearItems();for(const c of i)this.append(c);this.currentPage.octicons=this.octiconCache,this.pageStackUpdated()}activateCurrentPage(){this.currentQueryText="",this.currentPage.hasVisibleTip=this.hasVisibleTip,this.currentPage.octicons=this.octiconCache,this.currentPage.reactivate(this.query),this.pageStackUpdated()}hasPage(i){return this.pages.some(c=>c.scopeId===i.scopeId)}hideCurrentPages(){for(const i of this.pages)i.hidden=!0}navigate(i){this.currentPage.navigate(i)}cacheOcticons(i){i instanceof CustomEvent&&this.addOcticonsToCache(i.detail.octicons)}cacheLocalOcticons(){this.addOcticonsToCache(this.localOcticons.map(i=>({id:i.getAttribute("data-octicon-id"),svg:i.innerHTML.trim()})))}addOcticonsToCache(i){for(const c of i)this.octiconCache[c.id]=c.svg}commandPaletteActivated(){this.hideCurrentPages(),this.activateCurrentPage(),this.bindListeners()}pageStackUpdated(){this.dispatchEvent(new CustomEvent("command-palette-page-stack-updated",{bubbles:!0}))}connectedCallback(){this.setAttribute("data-target","command-palette.pageStack"),this.cacheLocalOcticons()}attributeChangedCallback(i,c,h){if(!!this.isConnected&&!!this.currentPage&&c!==h)switch(i){case"data-current-query-text":case"data-current-mode":this.currentPage.query=this.query,this.currentPage.fetch();break;case"data-has-visible-tip":this.currentPage.hasVisibleTip=this.hasVisibleTip;break}}disconnectedCallback(){this.unbindListeners()}bindListeners(){this.eventListenersBound||(window.addEventListener("resize",()=>this.currentPage.setMaxHeight()),this.eventListenersBound=!0)}unbindListeners(){window.removeEventListener("resize",()=>this.currentPage.setMaxHeight()),this.eventListenersBound=!1}},"CommandPalettePageStackElement");m([v.Lj],u.prototype,"currentMode",2),m([v.Lj],u.prototype,"currentQueryText",2),m([v.Lj],u.prototype,"hasVisibleTip",2),m([v.GO],u.prototype,"pages",2),m([v.GO],u.prototype,"localOcticons",2),u=m([v.Ih],u)}}]);})();

//# sourceMappingURL=9039-288968bfa9e4.js.map