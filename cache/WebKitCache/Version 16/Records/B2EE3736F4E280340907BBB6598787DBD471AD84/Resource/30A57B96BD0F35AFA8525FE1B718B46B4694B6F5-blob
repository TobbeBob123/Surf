"use strict";(()=>{var F=Object.defineProperty;var c=(I,C)=>F(I,"name",{value:C,configurable:!0});(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[7696],{3447:(I,C,E)=>{E.d(C,{D:()=>A,P:()=>O});var n=E(46263);function O(w=0,b={}){return(S,_,m)=>{if(!m||typeof m.value!="function")throw new Error("debounce can only decorate functions");const g=m.value;m.value=(0,n.P)(g,w,b),Object.defineProperty(S,_,m)}}c(O,"throttle");function A(w=0,b={}){return(S,_,m)=>{if(!m||typeof m.value!="function")throw new Error("debounce can only decorate functions");const g=m.value;m.value=(0,n.D)(g,w,b),Object.defineProperty(S,_,m)}}c(A,"debounce")},46263:(I,C,E)=>{E.d(C,{D:()=>O,P:()=>n});function n(A,w=0,{start:b=!0,middle:S=!0,once:_=!1}={}){let m=0,g,f=!1;function p(...z){if(f)return;const T=Date.now()-m;m=Date.now(),b?(b=!1,A.apply(this,z),_&&p.cancel()):(S&&T<w||!S)&&(clearTimeout(g),g=setTimeout(()=>{m=Date.now(),A.apply(this,z),_&&p.cancel()},S?w-T:w))}return c(p,"fn"),p.cancel=()=>{clearTimeout(g),f=!0},p}c(n,"throttle");function O(A,w=0,{start:b=!1,middle:S=!1,once:_=!1}={}){return n(A,w,{start:b,middle:S,once:_})}c(O,"debounce")},2382:(I,C,E)=>{var n=E(90420);class O extends HTMLElement{connectedCallback(){this.setAttribute("data-target","single-page-wizard-step.stepContent")}validateStep(r,i){this.dispatchEvent(new CustomEvent("single-page-wizard-step-validate",{bubbles:!0,detail:{isValid:r,autoProceed:i}}))}setError(r){this.dispatchEvent(new CustomEvent("single-page-wizard-step-error",{bubbles:!0,detail:{errorMessage:r}}))}clearError(){this.dispatchEvent(new CustomEvent("single-page-wizard-step-error",{bubbles:!0}))}async onStepRendered(){}setStepState(r){}async onNextClick(){return{proceed:!0}}async onPreviousClick(){return{proceed:!0}}isStepValid(){return!0}}c(O,"SinglePageWizardStepContentBase");var A=Object.defineProperty,w=Object.getOwnPropertyDescriptor,b=c((s,r,i,d)=>{for(var o=d>1?void 0:d?w(r,i):r,h=s.length-1,y;h>=0;h--)(y=s[h])&&(o=(d?y(r,i,o):y(o))||o);return d&&o&&A(r,i,o),o},"__decorateClass");let S=c(class extends O{async setStepState(s){this.wizardState=s}async onNextClick(){const s=this.form.querySelector(".js-data-url-csrf"),r=this.form.type.value,i=new FormData;i.append("type",r);const d=await fetch(this.form.action,{mode:"same-origin",method:"POST",body:i,headers:{Accept:"application/json","Scoped-CSRF-Token":s.value,"X-Requested-With":"XMLHttpRequest"}});if(!d.ok)return this.setError(this.errorMessage),{proceed:!1};const o=await d.json();return{wizardState:{...this.wizardState,type:r,formatted_recovery_codes:o.formatted_recovery_codes,mashed_secret:o.mashed_secret,qr_code:o.qr_code,dev_otp:o.dev_otp},proceed:!0}}},"TwoFactorSetupTypeSelectionElement");b([n.Lj],S.prototype,"errorMessage",2),b([n.fA],S.prototype,"form",2),S=b([n.Ih],S);var _=E(3447),m=Object.defineProperty,g=Object.getOwnPropertyDescriptor,f=c((s,r,i,d)=>{for(var o=d>1?void 0:d?g(r,i):r,h=s.length-1,y;h>=0;h--)(y=s[h])&&(o=(d?y(r,i,o):y(o))||o);return d&&o&&m(r,i,o),o},"verification_decorateClass");let p=c(class extends O{async setStepState(s){this.wizardState=s,this.isAppMode()?(this.renderQRCode(this.wizardState.qr_code),this.appOtpInput.value=this.wizardState.dev_otp||"",this.mashedSecret.textContent=this.wizardState.mashed_secret,this.appElem.hidden=!1):(this.wizardState.dev_otp&&(this.smsOtpInput.value=this.wizardState.dev_otp,this.smsOtpInput.disabled=!1),this.smsElem.hidden=!1)}async onStepRendered(){this.isAppMode()?this.appOtpInput.focus():this.smsPhoneInput.focus()}renderQRCode(s){this.qrCode.innerHTML="";for(const r of s){const i=document.createElement("tr");for(const d of r){const o=document.createElement("td");o.className=d?"black":"white",i.appendChild(o)}this.qrCode.appendChild(i)}}isAppMode(){return this.wizardState.type==="app"}async onNextClick(){this.clearError();const s=this.isAppMode()?this.appForm:this.smsForm,r=s.querySelector(".js-data-url-csrf"),i=new FormData,d=this.isAppMode()?this.appOtpInput.value:this.smsOtpInput.value;i.append("type",this.wizardState.type),i.append("otp",d.trim());const o=await fetch(s.action,{mode:"same-origin",method:"POST",body:i,headers:{Accept:"application/json","Scoped-CSRF-Token":r.value,"X-Requested-With":"XMLHttpRequest"}});if(!o.ok){const h=await o.json();return this.setError(h.error),{proceed:!1}}return{proceed:!0}}otpChange(){this.validateStep(this.isStepValid(),!0)}formSubmit(s){s.preventDefault(),this.otpChange()}smsPhoneInputChange(){this.buttonSendSms.disabled=this.smsPhoneInput.value.trim().length===0}setSmsControlState(s,r,i){const d=!s&&!r,o=d&&!i,h=d&&!!i;h&&(this.smsError.textContent=i),this.smsSendStatusError.hidden=!d,this.smsSendStatusSuccess.hidden=s||!r,this.smsSendStatusInProgress.hidden=!s,this.smsDefaultError.hidden=!o,this.smsError.hidden=!h,this.smsOtpInput.disabled=s||d,r&&this.smsOtpInput.focus()}async buttonSendSmsClick(){this.setSmsControlState(!0,!1),this.smsOtpInput.value="",this.smsOtpInput.disabled=!0,this.validateStep(!1);const s=this.buttonSendSms.getAttribute("data-url"),r=this.smsForm.querySelector(".js-data-url-csrf-send"),i=`${this.countryCodeSelect.value} ${this.smsPhoneInput.value}`,d=new FormData;d.append("number",i);const o=await fetch(s,{mode:"same-origin",method:"POST",body:d,headers:{Accept:"application/json","Scoped-CSRF-Token":r.value,"X-Requested-With":"XMLHttpRequest"}});if(!o.ok){const h=await o.json();this.setSmsControlState(!1,!1,h.error);return}this.setSmsControlState(!1,!0)}isStepValid(){const s=this.isAppMode()?this.appOtpInput:this.smsOtpInput;return new RegExp("^([0-9]{6})$").test(s.value)}},"TwoFactorSetupVerificationElement");f([n.fA],p.prototype,"appForm",2),f([n.fA],p.prototype,"smsForm",2),f([n.fA],p.prototype,"smsElem",2),f([n.fA],p.prototype,"appElem",2),f([n.fA],p.prototype,"countryCodeSelect",2),f([n.fA],p.prototype,"smsPhoneInput",2),f([n.fA],p.prototype,"appOtpInput",2),f([n.fA],p.prototype,"smsOtpInput",2),f([n.fA],p.prototype,"qrCode",2),f([n.fA],p.prototype,"mashedSecret",2),f([n.fA],p.prototype,"smsDefaultError",2),f([n.fA],p.prototype,"smsError",2),f([n.fA],p.prototype,"buttonSendSms",2),f([n.fA],p.prototype,"smsSendStatusError",2),f([n.fA],p.prototype,"smsSendStatusInProgress",2),f([n.fA],p.prototype,"smsSendStatusSuccess",2),f([(0,_.D)(50)],p.prototype,"otpChange",1),p=f([n.Ih],p);var z=Object.defineProperty,T=Object.getOwnPropertyDescriptor,R=c((s,r,i,d)=>{for(var o=d>1?void 0:d?T(r,i):r,h=s.length-1,y;h>=0;h--)(y=s[h])&&(o=(d?y(r,i,o):y(o))||o);return d&&o&&z(r,i,o),o},"recovery_codes_decorateClass");let P=c(class extends O{async setStepState(s){if(this.wizardState=s,this.codes.innerHTML="",this.wizardState.formatted_recovery_codes)for(const r of this.wizardState.formatted_recovery_codes){const i=document.createElement("li");i.textContent=r,i.className="two-factor-recovery-code",this.codes.appendChild(i)}}async onNextClick(){const s=this.form.querySelector(".js-data-url-csrf"),r=new FormData;if(r.append("type",this.wizardState.type),this.clearError(),!(await fetch(this.form.action,{mode:"same-origin",method:"POST",body:r,headers:{Accept:"application/json","Scoped-CSRF-Token":s.value,"X-Requested-With":"XMLHttpRequest"}})).ok)return this.setError(this.errorMessage),{proceed:!1};const d=document.getElementById("two-factor-reconfigure-notification");if(d){const o=d.querySelector(".js-flash-close");o&&o.click()}return{proceed:!0}}async onDownloadClick(){const s=window.onbeforeunload;return window.onbeforeunload=null,this.downloadCodesFormSubmitBtn.click(),setTimeout(()=>{window.onbeforeunload=s},0),this.validateStep(!0),{proceed:!0}}isStepValid(){return!1}},"TwoFactorSetupRecoveryCodesElement");R([n.Lj],P.prototype,"errorMessage",2),R([n.fA],P.prototype,"codes",2),R([n.fA],P.prototype,"form",2),R([n.fA],P.prototype,"downloadCodesForm",2),R([n.fA],P.prototype,"downloadCodesFormSubmitBtn",2),P=R([n.Ih],P)},90420:(I,C,E)=>{E.d(C,{Lj:()=>r,Ih:()=>q,P4:()=>f,fA:()=>z,GO:()=>T});const n=new WeakSet;function O(t){n.add(t),t.shadowRoot&&A(t.shadowRoot),S(t),b(t.ownerDocument)}c(O,"bind");function A(t){S(t),b(t)}c(A,"bindShadow");const w=new WeakMap;function b(t=document){if(w.has(t))return w.get(t);let e=!1;const a=new MutationObserver(l=>{for(const v of l)if(v.type==="attributes"&&v.target instanceof Element)g(v.target);else if(v.type==="childList"&&v.addedNodes.length)for(const D of v.addedNodes)D instanceof Element&&S(D)});a.observe(t,{childList:!0,subtree:!0,attributeFilter:["data-action"]});const u={get closed(){return e},unsubscribe(){e=!0,w.delete(t),a.disconnect()}};return w.set(t,u),u}c(b,"listenForBind");function S(t){for(const e of t.querySelectorAll("[data-action]"))g(e);t instanceof Element&&t.hasAttribute("data-action")&&g(t)}c(S,"bindElements");function _(t){const e=t.currentTarget;for(const a of m(e))if(t.type===a.type){const u=e.closest(a.tag);n.has(u)&&typeof u[a.method]=="function"&&u[a.method](t);const l=e.getRootNode();if(l instanceof ShadowRoot&&n.has(l.host)&&l.host.matches(a.tag)){const v=l.host;typeof v[a.method]=="function"&&v[a.method](t)}}}c(_,"handleEvent");function*m(t){for(const e of(t.getAttribute("data-action")||"").trim().split(/\s+/)){const a=e.lastIndexOf(":"),u=Math.max(0,e.lastIndexOf("#"))||e.length;yield{type:e.slice(0,a),tag:e.slice(a+1,u),method:e.slice(u+1)||"handleEvent"}}}c(m,"bindings");function g(t){for(const e of m(t))t.addEventListener(e.type,_)}c(g,"bindActions");function f(t,e){const a=t.tagName.toLowerCase();if(t.shadowRoot){for(const u of t.shadowRoot.querySelectorAll(`[data-target~="${a}.${e}"]`))if(!u.closest(a))return u}for(const u of t.querySelectorAll(`[data-target~="${a}.${e}"]`))if(u.closest(a)===t)return u}c(f,"findTarget");function p(t,e){const a=t.tagName.toLowerCase(),u=[];if(t.shadowRoot)for(const l of t.shadowRoot.querySelectorAll(`[data-targets~="${a}.${e}"]`))l.closest(a)||u.push(l);for(const l of t.querySelectorAll(`[data-targets~="${a}.${e}"]`))l.closest(a)===t&&u.push(l);return u}c(p,"findTargets");function z(t,e){return Object.defineProperty(t,e,{configurable:!0,get(){return f(this,e)}})}c(z,"target");function T(t,e){return Object.defineProperty(t,e,{configurable:!0,get(){return p(this,e)}})}c(T,"targets");function R(t){const e=t.name.replace(/([A-Z]($|[a-z]))/g,"-$1").replace(/(^-|-Element$)/g,"").toLowerCase();window.customElements.get(e)||(window[t.name]=t,window.customElements.define(e,t))}c(R,"register");function P(t){for(const e of t.querySelectorAll("template[data-shadowroot]"))e.parentElement===t&&t.attachShadow({mode:e.getAttribute("data-shadowroot")==="closed"?"closed":"open"}).append(e.content.cloneNode(!0))}c(P,"autoShadowRoot");const s=new WeakMap;function r(t,e){s.has(t)||s.set(t,[]),s.get(t).push(e)}c(r,"attr");function i(t,e){e||(e=d(Object.getPrototypeOf(t)));for(const a of e){const u=t[a],l=o(a);let v={configurable:!0,get(){return this.getAttribute(l)||""},set(D){this.setAttribute(l,D||"")}};typeof u=="number"?v={configurable:!0,get(){return Number(this.getAttribute(l)||0)},set(D){this.setAttribute(l,D)}}:typeof u=="boolean"&&(v={configurable:!0,get(){return this.hasAttribute(l)},set(D){this.toggleAttribute(l,D)}}),Object.defineProperty(t,a,v),a in t&&!t.hasAttribute(l)&&v.set.call(t,u)}}c(i,"initializeAttrs");function d(t){const e=new Set;let a=t;for(;a&&a!==HTMLElement;){const u=s.get(a)||[];for(const l of u)e.add(l);a=Object.getPrototypeOf(a)}return e}c(d,"getAttrNames");function o(t){return`data-${t.replace(/([A-Z]($|[a-z]))/g,"-$1")}`.replace(/--/g,"-").toLowerCase()}c(o,"attrToAttributeName");function h(t){let e=t.observedAttributes||[];Object.defineProperty(t,"observedAttributes",{configurable:!0,get(){return[...d(t.prototype)].map(o).concat(e)},set(a){e=a}})}c(h,"defineObservedAttributes");const y=new WeakSet;function M(t,e){t.toggleAttribute("data-catalyst",!0),customElements.upgrade(t),y.add(t),P(t),i(t),O(t),e&&e.call(t),t.shadowRoot&&A(t.shadowRoot)}c(M,"initializeInstance");function j(t){h(t),R(t)}c(j,"initializeClass");function k(t){return y.has(t)}c(k,"initialized");function q(t){const e=t.prototype.connectedCallback;t.prototype.connectedCallback=function(){M(this,e)},j(t)}c(q,"controller")}},I=>{var C=c(n=>I(I.s=n),"__webpack_exec__"),E=C(2382)}]);})();

//# sourceMappingURL=two-factor-setup-808c1ae08f5b.js.map