!function(){"use strict";var n=window.console||{log:function(){},info:function(){},warn:function(){},error:function(){}};function t(t){try{var e=window[t.storage];if(e&&e.getItem&&e.setItem&&e.removeItem)return e;n.info(t.storage+" not available. ")}catch(e){n.info(t.storage+" not available. ",e)}return!1}function e(e){try{var o=t(e);o&&o.removeItem(e.key)}catch(t){n.warn("Could not clear "+e.key+" from "+e.storage)}}function o(n,t){for(var e=0;e<t.length;e++){var o=t[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}function r(n){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)})(n)}function i(n,t){return(i=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n})(n,t)}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(n){return!1}}function c(n,t,e){return(c=a()?Reflect.construct:function(n,t,e){var o=[null];o.push.apply(o,t);var r=new(Function.bind.apply(n,o));return e&&i(r,e.prototype),r}).apply(null,arguments)}function u(n){var t="function"==typeof Map?new Map:void 0;return(u=function(n){if(null===n||(e=n,-1===Function.toString.call(e).indexOf("[native code]")))return n;var e;if("function"!=typeof n)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(n))return t.get(n);t.set(n,o)}function o(){return c(n,arguments,r(this).constructor)}return o.prototype=Object.create(n.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),i(o,n)})(n)}function s(n,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(n){if(void 0===n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}(n)}var f=[],l=function(n){!function(n,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),t&&i(n,t)}(p,n);var t,e,c,u,f,l=(t=p,e=a(),function(){var n,o=r(t);if(e){var i=r(this).constructor;n=Reflect.construct(o,arguments,i)}else n=o.apply(this,arguments);return s(this,n)});function p(n,t){var e;return function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),(e=l.call(this,n)).statusCode=t,e}return c=p,u&&o(c.prototype,u),f&&o(c,f),Object.defineProperty(c,"prototype",{writable:!1}),c}(u(Error));function p(t,e,o,r){r=r||d;var i=new window.XMLHttpRequest;i.onload=function(){var t=void 0,e=void 0;if(this.status>=200&&this.status<300)try{t=JSON.parse(this.responseText)}catch(n){e=n}else{var i="Server responded with status ".concat(this.status,": ").concat(this.responseText);e=new l(i,this.status)}t?o(t):e&&(n.info(e),r(e))},i.open("GET",t,!0),i.onerror=r,i.ontimeout=r,i.timeout=e,i.send()}function d(n){var t=window.onLoginError||!1;t.ok||(window.onLoginError=function(t){f.push(t),t(n)},window.onLoginError.ok=!0),t.q&&t.q.forEach((function(n){f.push(n[0])})),f.length>0&&f.forEach((function(t){t(n)}))}var g={key:"nrkno-login-status",ttl:9e5,storage:"sessionStorage"};function v(e,o,r,i){var a=t(e),c=e.key;if(a){var u=a.getItem(c);if(u)try{u=JSON.parse(u)}catch(t){n.warn("Could not parse "+e.key+" from "+e.storage,t)}u&&u.timestamp&&parseInt(u.timestamp,10)>(new Date).getTime()-e.ttl?i(u):p(o,r,(function(n){n.timestamp=(new Date).getTime(),a.setItem(c,JSON.stringify(n)),i(n)}))}else p(o,r,i)}function w(n,t,e){return"string"==typeof t&&(e+=e.indexOf("?")>0?"&":"?",e+=n+"="+t),e}function m(n,t,e){return void 0!==t&&(e+=e.indexOf("?")>0?"&":"?",e+=n+"="+Boolean(t)),e}function y(n,t,e){t=t||{};var o=n;return o=w(e.redirectPathParameter,t.redirectPath,o),o=w(e.abortPathParameter,t.abortPath,o),o=w(e.languageParameter,t.language,o)}function h(n){return n.loggedIn?n.user:null}v({key:"nrkno-login-config",ttl:9e5,storage:"localStorage"},"/logginn/config",2e3,(function(n){v(g,"/logginn/status",8e3,(function(t){!function(n,t){var o,r=h(t);if(function(n,t,o){var r=h(t),i=window.onLoginReady||!1;i.ok||(window.onLoginReady=function(t){var i=function(n,t,o){var r=!1,i=[];function a(n,t){i.forEach((function(e){e(n,t)})),i=[],r=!1}return{login:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e(g);var o=y(n.loginUrl,t,n);o=w(n.loginContextParameter,t.context,o),o=m(n.loginShowConfirmationParameter,t.showConfirmation,o),o=w(n.loginIntroParameter,t.intro,o),o=w(n.loginOutroParameter,t.outro,o),o=w(n.loginRequirementsParameter,t.requirements,o),window.location.assign(o)},logout:function(t){o(),e(g);var r=y(n.logoutUrl,t,n);window.location.replace(r)},token:function(o){t?t.accessToken&&Date.parse(t.accessTokenExpiry)>Date.now()?o(null,{accessToken:t.accessToken,expiresAt:t.accessTokenExpiry}):(i.push(o),r||(r=!0,p(n.tokenUrl,5e3,(function(n){t.accessToken=n.accessToken,t.accessTokenExpiry=n.expiresAt,a(null,n)}),(function(n){"statusCode"in n&&401===n.statusCode?(e(g),window.location.reload()):a(n,null)})))):o(new Error("Not logged in"),null)},consentTo:function(o,r){if(r=r||{},o){if(t&&t.consent&&o.split(",").map(a).every((function(n){return t.consent.map(a).some((function(t){return t.term===n.term&&t.version>=n.version}))})))return!0;e(g);var i=y(n.consentUrl,r,n);return i=w(n.consentTermsParameter,o,i),i=w(n.consentContextParameter,r.context,i),window.location.replace(i),!1}function a(n){var t=n.indexOf(":");return t>0?{term:n.substring(0,t),version:Number(n.substring(t+1))}:{term:n,version:1}}}}}(n,r,o);t(r||!1,i)},window.onLoginReady.ok=!0),i.q&&i.q.forEach((function(n){window.onLoginReady(n[0])}))}(n,t,(function(){return clearInterval(o)})),!(window.location.href.indexOf("viewContext")>0)){var i=String(n.checkSessionIframeUrl.match(/https:\/\/[^/]+/)),a=document.createElement("iframe"),c=n.clientId+" "+(r?r.sessionState:"none"),u=2e3;a.src=n.checkSessionIframeUrl,a.style.display="none",a.onload=function(){var r;window.addEventListener("message",function(n,t,o,r){var i=h(t);return function(a){if(a.origin===o){if("unchanged"===a.data&&i||r(),"changed"===a.data){e(g);var c=n.loginUrl;t.invalidCookie||(c+=c.indexOf("?")>0?"&":"?",c+="autoLogin=true"),window.location.replace(c)}if("ended"===a.data){e(g);var u=n.logoutUrl;u+=u.indexOf("?")>0?"&":"?",u+=n.logoutConfirmedParameter+"=true",u+="&"+n.localLogoutParameter+"=true",window.location.replace(u)}}}}(n,t,i,(function(){return clearInterval(o)}))),o=setInterval((function(){var n;null==a||null===(n=a.contentWindow)||void 0===n||n.postMessage(c,i)}),u),null==a||null===(r=a.contentWindow)||void 0===r||r.postMessage(c,i)},document.body.appendChild(a)}}(n,t)}))}))}();
