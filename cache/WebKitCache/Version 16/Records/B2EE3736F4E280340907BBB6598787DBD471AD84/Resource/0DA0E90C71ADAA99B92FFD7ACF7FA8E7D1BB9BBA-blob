/*!! Core Analytics v6.10.15 - Copyright (c) 2015-2022 NRK */
this.CA6=this.CA6||{},this.CA6["recommendations/ecommerce"]=function(){"use strict";var e={exports:{}};e.exports=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var i in n)t[i]=n[i]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function n(i){function o(){}function r(t,n,r){if("undefined"!=typeof document){"number"==typeof(r=e({path:"/"},o.defaults,r)).expires&&(r.expires=new Date(1*new Date+864e5*r.expires)),r.expires=r.expires?r.expires.toUTCString():"";try{var c=JSON.stringify(n);/^[\{\[]/.test(c)&&(n=c)}catch(e){}n=i.write?i.write(n,t):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a="";for(var s in r)r[s]&&(a+="; "+s,!0!==r[s]&&(a+="="+r[s].split(";")[0]));return document.cookie=t+"="+n+a}}function c(e,n){if("undefined"!=typeof document){for(var o={},r=document.cookie?document.cookie.split("; "):[],c=0;c<r.length;c++){var a=r[c].split("="),s=a.slice(1).join("=");n||'"'!==s.charAt(0)||(s=s.slice(1,-1));try{var d=t(a[0]);if(s=(i.read||i)(s,d)||t(s),n)try{s=JSON.parse(s)}catch(e){}if(o[d]=s,e===d)break}catch(e){}}return e?o[e]:o}}return o.set=r,o.get=function(e){return c(e,!1)},o.getJSON=function(e){return c(e,!0)},o.remove=function(t,n){r(t,"",e(n,{expires:-1}))},o.defaults={},o.withConverter=n,o}((function(){}))}();var t=e.exports;function n(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.filter((function(e){return e})).forEach((function(t){Object.keys(t).forEach((function(n){return e[n]=t[n]}))})),e}var i=function(){if("undefined"==typeof window)return function(){return null};var e=window.Element.prototype,t=e.matches||e.msMatchesSelector||e.webkitMatchesSelector;return function(n,i){if(e.closest)return n.closest(i);for(var o=n;o;o=o.parentElement)if(t.call(o,i))return o;return null}}();function o(e,n,i){if(void 0===i&&(i=1),!1===n)t.remove(e);else{if(void 0===n)return t.getJSON(e);t.set(e,n,{expires:i})}}function r(e,t){return void 0===t&&(t=document),[].slice.call(t.querySelectorAll(e))}function c(e,t,n){if(e>t)throw new Error("min must not be greater than max in clamp(min, max, value)");return n<e?e:n>t?t:n}const a="data-core-analytics-ec-referrer";return e=>{let t,s,d,u={},l=[],f=!0;const m=(p=S,v=1e3,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this;clearTimeout(g),g=window.setTimeout((function(){return p.apply(n,e)}),v)});var p,v,g;window._gaTracker=e;const h=e.get("gaEmit");function w(e){const{eventAction:t="",eventLabel:n=""}=e.ga;/media-playback-accumulated/i.test(t)&&(/120-seconds/i.test(n)&&b(),/completed-stream/i.test(n)&&(b(),k()))}function y(e){Math.floor(e)>=3&&b(),e/this.duration()*100>=95&&k()}function b(){const e=o(a),t=E(e);t&&!e.reportedStarted&&(o(a,n(e,{reportedStarted:!0})),h("ec:addProduct",t),h("ec:setAction","add",{list:t.list}),h("send","event","content-impressions","content-impression-started","started",{nonInteraction:!0,dimension9:"1"}))}function k(){const e=o(a),t=E(e);t&&e.reportedStarted&&(o(a,!1),h("ec:addProduct",t),h("ec:setAction","checkout",{list:t.list}),h("send","event","content-impressions","content-impression-completed","completed",{nonInteraction:!0,dimension9:"1"}))}function A(t){if(!t)return!1;const n=["id","name","list","position","variant","brand"],i=n.filter((e=>!t[e]));return i.length?(e("error",new Error(`Invalid recommendations item, missing: ${i.join(", ")} in ${JSON.stringify(t)}`)),!1):n.concat("category").reduce(((e,n)=>(t[n]&&(e[n]=t[n]),e)),{})}function E(e){const t=A(e);if(!t)return!1;return n(t,Object.keys(e).reduce(((t,n)=>(n.match(/^dimension\d{1,2}$/)&&(t[n]=e[n]),t)),{}))}function C(n){const o=i(n,"[data-ec-list]");if(!o)return e("error",new Error("Trying to track a stray ecommerce element, please put it in a ecommerce list")),!1;const c=n.getAttribute("data-ec-position"),a=c?parseInt(c,10):r("[data-ec-id]",o).indexOf(n)+1,s=Object.keys(o.dataset).reduce(((e,t)=>{const n=t.replace("ec","").toLowerCase();return n.match(/^dimension\d{1,2}$/)&&(e[n]=o.dataset[t]),e}),{});return Object.assign(A({id:n.getAttribute("data-ec-id"),name:n.getAttribute("data-ec-name"),position:a,variant:n.getAttribute("data-ec-variant"),list:o.getAttribute("data-ec-list"),category:n.getAttribute("data-ec-category"),brand:n.getAttribute("data-ec-brand")||t}),s)}function I(e){if(!t)return;x();const n=e&&C(e);n&&(o(a,n),h("ec:addProduct",n),h("ec:setAction","click",{list:n.list}),h("send","event","content-impressions","content-impression-click","click",{dimension9:"1"}))}function S(){t&&r("[data-ec-id]").filter(e.contains).forEach((e=>{const t=C(e);if(t){const n=`${t.list}-${t.id}`;t&&!u[n]&&function(e){const t=e.getAttribute("data-ec-element-selector");return function(e,t){void 0===t&&(t=1);var n=e.getBoundingClientRect();if("hidden"===window.getComputedStyle(e).visibility)return!1;for(var i=(c(0,window.innerWidth,n.right)-c(0,window.innerWidth,n.left))*(c(0,window.innerHeight,n.bottom)-c(0,window.innerHeight,n.top))/(n.width*n.height)>=t,o=e;o&&i;o=o.parentElement){var r=window.getComputedStyle(e);if("hidden"===r.visibility)return!1;var a=("scroll"===r.overflowY||"scroll"===r.overflowX||"scroll"===r.overflow)&&o.getBoundingClientRect();a&&(i=(c(0,a.width,n.right)-c(0,a.width,n.left))*(c(0,a.height,n.bottom)-c(0,a.height,n.top))/(n.width*n.height)>=t)}return i}((t?e.querySelector(t):null)||e,d)}(e)&&(u[n]=!0,l.push(t))}}))}function x(){l.length&&(l.forEach((e=>{h("ec:addImpression",e)})),h("send","event","content-impressions","content-impression-view","view",{nonInteraction:!0,dimension9:"1"}),l=[])}h?(e.on("recommendations",(function(n){if(n&&"ludoInstance"in n){const t=n.ludoInstance||{};"function"==typeof t.on&&"function"==typeof t.off&&"function"==typeof t.get&&"function"==typeof t.duration?function(e){const t=e.get("coreAnalyticsInstance");t?(t.off("event.personalization",w),t.on("event.personalization",w)):(e.off("timeupdate",y),e.on("timeupdate",y))}(t):e("error",new Error("recommendation was initialized with a empty or invalid ludoInstance"))}t=n&&n.contentId,s=n&&n.contentGroupId,u={},l=[],n&&"boolean"==typeof n.autoTrackClicks&&(f=n.autoTrackClicks);n&&n.elementVisibilityRatio&&(d=n.elementVisibilityRatio);h("require","ec"),function(){const e=o(a),n=E(e);if(!n)return o(a,!1);if(t!==n.id&&s!==n.id||e.reportedStarted)return o(a,!1);h("ec:addProduct",n),h("ec:setAction","detail",{list:n.list}),h("send","event","content-impressions","content-impression-detail","detail",{nonInteraction:!0,dimension9:"1"})}(),S()})),e.on("recommendations.click",(function(e){!f&&e.item&&I(e.item)})),e.on("recommendations.started",b),e.on("recommendations.completed",k),document.addEventListener("click",(function(t){if(f&&t&&t.target){I(e.contains(i(t.target,"[data-ec-id]")))}})),document.addEventListener("DOMContentReady",m),document.addEventListener("scroll",m,!0),window.addEventListener("scroll",m),window.addEventListener("load",m),window.addEventListener("beforeunload",x),setInterval(x,1e4)):e("error",new Error("recommendations requires a Google Analytics tracking id"))}}();
//# sourceMappingURL=ecommerce.min.js.map
