define("discourse/plugins/retort/discourse/connectors/above-footer/emoji-picker-wrapper",["exports","../../lib/retort"],(function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i={setupComponent:function(e,i){t.default.setPicker(i)}};e.default=i})),define("discourse/plugins/retort/discourse/initializers/retort-init",["exports","discourse/lib/plugin-api","discourse/lib/text","@ember/runloop","discourse-common/utils/decorators","@ember/object","@popperjs/core","discourse/lib/utilities","pretty-text/emoji","discourse/routes/topic","../lib/retort","discourse/models/user"],(function(e,t,i,o,r,s,n,c,a,l,u,d){"use strict";function p(e,t,i,o,r){var s={};return Object.keys(o).forEach((function(e){s[e]=o[e]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=i.slice().reverse().reduce((function(i,o){return o(e,t,i)||i}),s),r&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(r):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(e,t,s),s=null),s}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var f={name:"retort-button",initialize:function(){(0,t.withPluginApi)("0.8.6",(function(e){return function(e){var t,l,f,m,v=e.container.lookup("site-settings:main"),h=v.retort_enabled,b=v.retort_allowed_emojis,g=v.retort_limited_emoji_set,j=e.container.lookup("message-bus:main");h&&(e.decorateWidget("post-menu:before-extra-controls",(function(e){var t=e.getModel().id,i=u.default.postFor(t);if(!u.default.disabledFor(t)&&(u.default.storeWidget(e),i.retorts)){var o=i.retorts.map((function(t){var o=t.usernames,r=t.emoji;return e.attach("retort-toggle",{post:i,usernames:o,emoji:r})}));return e.h("div.post-retort-container",o)}})),e.addPostClassesCallback((function(e){if(!u.default.disabledFor(e.id))return["retort"]})),d.default.current()&&(e.modifyClass("route:topic",{setupController:function(e,t){u.default.initialize(j,t),this._super(e,t)}}),e.addPostMenuButton("retort",(function(e){if(!u.default.disabledFor(e.id))return{action:"clickRetort",icon:"far-smile",title:"retort.title",position:"first",className:"retort"}})),e.attachWidgetAction("post-menu","clickRetort",(function(){u.default.openPicker(this.findAncestorModel())})),e.modifyClass("component:emoji-picker",(t=(0,r.default)("retort"),l=(0,r.default)("retort","isActive"),f=(0,r.observes)("isActive"),p(m={limited:function(){return this.retort&&g},activeRetort:function(){return this.retort&&this.isActive},_setup:function(){this.retort?this._setupRetort():this._super()},_setupRetort:function(){this.isActive?this.onShowRetort():this.onClose()},onShowRetort:function(){var e=this;this.limited||this.set("isLoading",!0),(0,o.schedule)("afterRender",(function(){document.addEventListener("click",e.handleOutsideClick);var t=e.post,r=document.querySelector(".emoji-picker"),s=document.querySelector('\n          article[data-post-id="'.concat(t.id,'"] .post-controls .retort'));if(!r||!s)return!1;if(e.site.isMobileDevice||(e._popper=(0,n.createPopper)(s,r,{placement:e.limited?"top":"bottom"})),e.limited){var c=b.split("|");e._emojisPerRow[c.length],r.innerHTML="\n            <div class='limited-emoji-set'>\n              ".concat(c.map((function(e){return'<img\n                src="'.concat((0,i.emojiUrlFor)(e),"\"\n                width=40\n                height=40\n                title='").concat(e,"'\n                class='emoji' />")})).join(""),"\n            </div>\n          "),r.classList.add("has-limited-set"),r.onclick=function(t){t.target.classList.contains("emoji")?e.emojiSelected(t.target.title):(e.set("isActive",!1),e.onClose())}}else r.querySelectorAll(".emojis-container .section .section-header").forEach((function(t){return e._sectionObserver.observe(t)})),(0,o.later)((function(){e.set("isLoading",!1),e.applyDiscourseTrick(r)}),50)}))},applyDiscourseTrick:function(e){var t=this;(0,o.schedule)("afterRender",(function(){if((!t.site.isMobileDevice||t.isEditorFocused)&&!(0,c.safariHacksDisabled)()){var i=e.querySelector("input.filter");i&&i.focus()}0!==t.selectedDiversity&&t._applyDiversity(t.selectedDiversity)}))},onCategorySelection:function(e){var t=document.querySelector('.emoji-picker-emoji-area .section[data-section="'.concat(e,'"]'));t&&t.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})},onFilter:function(e){var t=document.querySelector(".emoji-picker-emoji-area"),i=t.querySelector(".emojis-container"),o=t.querySelector(".results");o.innerHTML="",e.target.value?(o.innerHTML=(0,a.emojiSearch)(e.target.value.toLowerCase(),{maxResults:10,diversity:this.emojiStore.diversity}).map(this._replaceEmoji).join(""),i.style.visibility="hidden",o.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})):i.style.visibility="visible"},_emojisPerRow:{0:1,1:1,2:2,3:3,4:4,5:5,6:3,7:3,8:4,9:3,10:5,11:5,12:4,13:5,14:7,15:5,16:4,17:5,18:6,19:6,20:5,21:7,22:5,23:5,24:6}},"limited",[t],Object.getOwnPropertyDescriptor(m,"limited"),m),p(m,"activeRetort",[l],Object.getOwnPropertyDescriptor(m,"activeRetort"),m),p(m,"_setup",[f],Object.getOwnPropertyDescriptor(m,"_setup"),m),p(m,"onShowRetort",[s.action],Object.getOwnPropertyDescriptor(m,"onShowRetort"),m),p(m,"onCategorySelection",[s.action],Object.getOwnPropertyDescriptor(m,"onCategorySelection"),m),p(m,"onFilter",[s.action],Object.getOwnPropertyDescriptor(m,"onFilter"),m),m))))}(e)}))}};e.default=f})),define("discourse/plugins/retort/discourse/lib/retort",["exports","discourse/lib/ajax","discourse/lib/ajax-error","discourse-common/lib/get-owner"],(function(e,t,i,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=Ember.Object.create({topic:{postStream:{posts:[]}},initialize:function(e,t){var i=this;this.topic.id&&e.unsubscribe("/retort/topics/".concat(this.topic.id)),this.set("topic",t),e.subscribe("/retort/topics/".concat(this.topic.id),(function(e){var t=e.id,o=e.retorts,r=i.postFor(t);r&&(r.setProperties({retorts:o}),i.get("widgets.".concat(t)).scheduleRerender())}));var r=(0,o.getOwner)(this).lookup("site-settings:main");this.set("siteSettings",r)},postFor:function(e){return(this.get("topic.postStream.posts")||[]).find((function(t){return t.id==e}))},storeWidget:function(e){this.get("widgets")||this.set("widgets",{}),this.set("widgets.".concat(e.getModel().id),e.widget)},updateRetort:function(e,o){var r=e.id;return(0,t.ajax)("/retorts/".concat(r,".json"),{type:"POST",data:{retort:o}}).catch(i.popupAjaxError)},disabledCategories:function(){return this.siteSettings.retort_disabled_categories.split("|").map((function(e){return e.toLowerCase()})).filter(Boolean)},disabledFor:function(e){var t=this.postFor(e);if(!t)return!0;if(!t.topic.details.can_create_post)return!0;if(t.get("topic.archived"))return!0;var i=t.get("topic.category.name"),o=this.disabledCategories();return i&&o.includes(i.toString().toLowerCase())},openPicker:function(e){this.set("picker.isActive",!0),this.set("picker.post",e)},setPicker:function(e){var t=this;this.set("picker",e),this.set("picker.emojiSelected",(function(i){return t.updateRetort(e.post,i).then((function(){return e.set("isActive",!1)}))}))}});e.default=r})),Ember.TEMPLATES["javascripts/connectors/above-footer/emoji-picker-wrapper"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[1,[28,"emoji-picker",null,[["retort","isActive","post","emojiSelected","onEmojiPickerClose"],[true,[24,["isActive"]],[24,["post"]],[24,["emojiSelected"]],[28,"action",[[23,0,[]],[28,"mut",[[24,["isActive"]]],null],false],null]]]],false]],"hasEval":false}',meta:{moduleName:"javascripts/discourse/templates/connectors/above-footer/emoji-picker-wrapper"}}),define("discourse/plugins/retort/discourse/widgets/retort-toggle",["exports","virtual-dom","discourse/lib/text","discourse/widgets/widget","../lib/retort"],(function(e,t,i,o,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=(0,o.createWidget)("retort-toggle",{tagName:"button.post-retort",buildKey:function(e){return"retort-toggle-".concat(e.emoji,"-").concat(e.usernames.length)},defaultState:function(e){return{emoji:e.emoji,post:e.post,usernames:e.usernames}},click:function(){var e=this.state,t=e.post,i=e.emoji;r.default.updateRetort(t,i)},html:function(){var e=this.state,o=e.emoji,r=e.usernames;return[(0,t.h)("img.emoji",{src:(0,i.emojiUrlFor)(o),alt:":".concat(o,":")}),r.length>1?(0,t.h)("span.post-retort__count",r.length.toString()):"",(0,t.h)("span.post-retort__tooltip",this.sentence(this.state))]},sentence:function(e){var t,i=e.usernames,o=e.emoji;switch(i.length){case 1:t="retort.reactions.one_person";break;case 2:t="retort.reactions.two_people";break;default:t="retort.reactions.many_people"}return I18n.t(t,{emoji:o,first:i[0],second:i[1],count:i.length-2})}});e.default=s}));
//# sourceMappingURL=retort-0e1f4139b106d9de4d87ddcfce2c8844fa0482bef5d792096716d2eb90a920aa.js.map